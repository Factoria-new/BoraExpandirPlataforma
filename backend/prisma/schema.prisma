datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

// 1. Enumeração para tipos de usuário
enum TipoUsuario {
  CLIENTE
  FINANCEIRO
  JURIDICO
  SUPER_ADMIN
}

model Usuario {
  // ID vem do Supabase Auth (UUID). Não geramos default aqui.
  id             String      @id @db.Uuid
  email          String      @unique
  nome           String?
  tipo           TipoUsuario @default(CLIENTE)
  bucketRootPath String?     @map("bucket_root_path")

  notificacoes   Notificacao[]

  criadoEm       DateTime    @default(now()) @map("criado_em")
  atualizadoEm   DateTime    @updatedAt @map("atualizado_em")

  @@map("usuarios")
}

model Notificacao {
  id        String   @id @default(uuid()) // Gerado pelo Prisma
  mensagem  String
  lida      Boolean  @default(false)
  criadoEm  DateTime @default(now()) @map("criado_em")

  usuarioId String   @db.Uuid @map("usuario_id")
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("notificacoes")
}

// Enumeração para status do documento
enum StatusDocumento {
  PENDING     // Aguardando análise
  ANALYZING   // Em análise
  APPROVED    // Aprovado
  REJECTED    // Rejeitado
}

// Modelo para armazenar documentos dos clientes
model Documento {
  id              String          @id @default(uuid())
  
  // Relacionamento com o cliente (UUID do Supabase)
  clienteId       String          @db.Uuid @map("cliente_id")
  memberId        String?         @map("member_id") // ID do membro familiar (pode ser string simples ou UUID)
  
  // Informações do arquivo
  tipo            String          // Tipo do documento (passport, identity, proof_of_address, etc.)
  nomeOriginal    String          @map("nome_original")  // Nome original do arquivo
  nomeArquivo     String          @map("nome_arquivo")   // Nome salvo no storage
  storagePath     String          @map("storage_path")   // Caminho completo no Supabase Storage
  publicUrl       String?         @map("public_url")     // URL pública do arquivo
  contentType     String?         @map("content_type")   // MIME type do arquivo
  tamanho         Int?            // Tamanho em bytes
  
  // Status e análise
  status          StatusDocumento @default(PENDING)
  apostilado      Boolean         @default(false)
  traduzido       Boolean         @default(false)
  motivoRejeicao  String?         @map("motivo_rejeicao")
  analisadoPor    String?         @db.Uuid @map("analisado_por") // ID do usuário que analisou
  analisadoEm     DateTime?       @map("analisado_em")
  
  // Timestamps
  criadoEm        DateTime        @default(now()) @map("criado_em")
  atualizadoEm    DateTime        @updatedAt @map("atualizado_em")

  @@index([clienteId])
  @@index([tipo])
  @@index([status])
  @@map("documentos")
}